# ITStart Admin Panel

Административная панель для управления системой ITStart.

## Технологии

- **React 18** - UI библиотека
- **TypeScript** - типизация
- **Vite** - сборщик и dev-сервер
- **React Router** - маршрутизация
- **React Query (@tanstack/react-query)** - управление состоянием и кеширование
- **ky** - HTTP клиент
- **react-hook-form** - управление формами
- **zod** - валидация схем
- **shadcn/ui** - UI компоненты
- **Tailwind CSS** - стилизация
- **date-fns** - работа с датами
- **lucide-react** - иконки

## Установка

```bash
cd src/itstart_admin
npm install
```

## Настройка

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Установите переменную окружения:

```
VITE_API_URL=http://localhost:8000
```

## Запуск

### Development

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173`

### Production Build

```bash
npm run build
```

Собранные файлы будут в папке `dist/`

### Preview Production Build

```bash
npm run preview
```

## Структура проекта

```
src/
├── components/          # React компоненты
│   ├── auth/          # Компоненты аутентификации
│   ├── layout/        # Layout компоненты (Header, Sidebar)
│   ├── ui/            # Базовые UI компоненты (shadcn/ui)
│   ├── admin-users/   # Компоненты управления пользователями
│   ├── publications/  # Компоненты публикаций
│   ├── tags/          # Компоненты тегов
│   ├── parsers/       # Компоненты парсеров
│   └── export/        # Компоненты экспорта
├── hooks/             # React Query хуки
├── lib/               # Утилиты и хелперы
│   ├── api.ts        # API клиент (ky)
│   ├── auth.ts       # Функции работы с токенами
│   ├── query-client.ts # Настройка React Query
│   └── ...
├── pages/             # Страницы приложения
│   ├── auth/         # Страница входа
│   ├── publications/ # Страницы публикаций
│   ├── admin-users/  # Страницы пользователей
│   ├── tags/         # Страницы тегов
│   ├── parsers/      # Страницы парсеров
│   ├── stats/        # Страница статистики
│   └── schedule/     # Страница расписания
├── providers/         # React провайдеры
├── router/           # Конфигурация роутинга
└── types/            # TypeScript типы

```

## Функциональность

### Аутентификация

- Вход по логину и паролю
- Поддержка 2FA (TOTP)
- Автоматическое обновление токенов
- Смена пароля
- Защищенные роуты

### Управление пользователями (только для admin)

- Список всех пользователей админки
- Создание новых пользователей
- Редактирование пользователей (роль, статус, пароль)
- Блокировка пользователей

### Публикации

- Просмотр списка публикаций с фильтрацией
- Фильтры: тип, статус, дата, теги
- Детальный просмотр публикации
- Редактирование публикаций
- Модерация (отклонение с указанием причины)
- Одобрение и отправка публикаций

### Управление тегами (только для admin)

- Просмотр тегов по категориям
- Создание новых тегов
- Редактирование тегов
- Удаление тегов

### Управление парсерами (только для admin)

- Список всех парсеров
- Создание новых парсеров
- Редактирование парсеров
- Включение/отключение парсеров

### Статистика (только для admin)

- Статистика пользователей (подписки, отписки, активные)
- Топ-5 тегов
- Процент ошибок парсеров
- Публикации по дням
- Экспорт публикаций в CSV/Excel

### Расписание (только для admin)

- Просмотр текущего расписания рассылки
- Настройка интервалов для каждого типа публикаций

## Роли

- **admin** - полный доступ ко всем разделам
- **moderator** - доступ только к публикациям

## API

Админка использует REST API, описанный в `docs/openapi.json`. Все эндпоинты покрыты реализацией.

## Docker

### Сборка образа

```bash
docker build -f Dockerfile.admin -t itstart-admin .
```

### Запуск через Docker Compose

Админка включена в основной `docker-compose.yml` проекта:

```bash
# Из корня проекта
docker-compose up admin
```

Или для всех сервисов:

```bash
docker-compose up
```

Админка будет доступна по адресу `http://localhost:3000` (порт можно изменить через переменную `ADMIN_PORT` в `.env`).

### Переменные окружения для Docker

В `docker-compose.yml` можно настроить:

- `VITE_API_URL` - URL бэкенд API (по умолчанию `http://core-api:8000` для внутренней сети Docker)
- `ADMIN_PORT` - порт для доступа к админке (по умолчанию `3000`)

**Важно:** `VITE_API_URL` используется на этапе сборки (build time), поэтому при изменении нужно пересобрать образ:

```bash
docker-compose build admin
docker-compose up admin
```

## Разработка

### Добавление нового компонента

Компоненты shadcn/ui можно добавить через CLI:

```bash
npx shadcn-ui@latest add [component-name]
```

### Линтинг

```bash
npm run lint
```

## Лицензия

Внутренний проект ITStart

